name: tests

on:
  # Trigger the deploy on push to main branch
  push:
    branches:
      - master
      - 2023

jobs: 
  # This job deploys the example book
  test-book:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3

    - name: Install conda environment from environment.yml
      uses: mamba-org/provision-with-micromamba@main

    - name: Test links
      shell: bash -l {0}
      run: |
        jupyter-book . --builder linkcheck
    
    - name: Test worksheet solutions
      shell: bash -l {0}
      run: |
        jupyter nbconvert --clear-output --to notebook --inplace ws/*impemented.ipynb
        jupyter execute ws/*implemented.ipynb

    # Build the example book
    - name: Build book
      shell: bash -l {0}
      run: |
        jupyter nbconvert --clear-output --to notebook --inplace ws/*impemented.ipynb
        jupyter-book build .
